# Pod Security Standards for SIEM namespace
apiVersion: v1
kind: ConfigMap
metadata:
  name: siem-pod-security
  namespace: siem
data:
  policy.yaml: |
    apiVersion: policy/v1beta1
    kind: PodSecurityPolicy
    metadata:
      name: siem-restricted
      namespace: siem
    spec:
      privileged: false
      allowPrivilegeEscalation: false
      requiredDropCapabilities:
        - ALL
      allowedCapabilities:
        - NET_BIND_SERVICE
      runAsUser:
        rule: MustRunAsNonRoot
      runAsGroup:
        rule: MustRunAs
        ranges:
        - min: 1000
          max: 65535
      supplementalGroups:
        rule: MustRunAs
        ranges:
        - min: 1000
          max: 65535
      fsGroup:
        rule: MustRunAs
        ranges:
        - min: 1000
          max: 65535
      seLinux:
        rule: RunAsAny
      volumes:
      - configMap
      - secret
      - emptyDir
      - persistentVolumeClaim
---
# Resource Quotas for SIEM namespace
apiVersion: v1
kind: ResourceQuota
metadata:
  name: siem-resource-quota
  namespace: siem
spec:
  hard:
    requests.cpu: "4"
    requests.memory: 8Gi
    limits.cpu: "8"
    limits.memory: 16Gi
    persistentvolumeclaims: "5"
    pods: "20"
    services: "10"
    secrets: "10"
    configmaps: "20"
---
# Network Policy: Strict SIEM protection
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: siem-strict-protection
  namespace: siem
spec:
  podSelector:
    matchLabels:
      component: siem
  policyTypes:
    - Ingress
    - Egress
  ingress:
    # Allow Wazuh agent communication from honeynet
    - from:
        - namespaceSelector:
            matchLabels:
              name: honeynet
      ports:
        - protocol: TCP
          port: 1514  # Agent enrollment
        - protocol: TCP
          port: 1515  # Agent communication
        - protocol: UDP
          port: 514   # Syslog
    # Allow internal SIEM communication
    - from:
        - podSelector:
            matchLabels:
              component: siem
  egress:
    # Allow DNS resolution
    - to: []
      ports:
        - protocol: UDP
          port: 53
    # Allow internal SIEM communication
    - to:
        - podSelector:
            matchLabels:
              component: siem
    # Allow HTTPS outbound (for updates, threat intel, etc.)
    - to: []
      ports:
        - protocol: TCP
          port: 443
---
# RBAC: Minimal permissions for SIEM components
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: siem-component-role
  namespace: siem
rules:
- apiGroups: [""]
  resources: ["configmaps", "secrets"]
  verbs: ["get", "list", "watch"]
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "list"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: siem-component-binding
  namespace: siem
subjects:
- kind: ServiceAccount
  name: default
  namespace: siem
roleRef:
  kind: Role
  name: siem-component-role
  apiGroup: rbac.authorization.k8s.io